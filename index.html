<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‚¬çœ APP</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }
        
        body {
            padding: 0;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            box-sizing: border-box;
        }
        
        /* æ‰‹æœºå±å¹• - å“åº”å¼è®¾è®¡ */
        .phone-screen {
            width: 100vw;
            height: 100vh;
            background: #000;
            border-radius: 0;
            overflow: visible;
            position: relative;
            box-shadow: none;
        }
        
        /* é¡¶éƒ¨çŠ¶æ€æ  */
        .status-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 30px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            z-index: 10;
        }
        
        /* åº”ç”¨æ ‡é¢˜æ  */
        .app-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: clamp(50px, 10%, 80px);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.6) 0%, rgba(118, 75, 162, 0.6) 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(16px, 4vw, 28px);
            font-weight: 600;
            letter-spacing: 1px;
            z-index: 100;
            box-shadow: 
                0 8px 32px rgba(102, 126, 234, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* ç€è‰²å™¨å®¹å™¨ */
        #container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            padding: 0;
        }
        
        canvas {
            width: 100% !important;
            height: 100% !important;
            border-radius: 15px;
            box-shadow: 
                0 0 30px rgba(128, 0, 255, 0.5),
                inset 0 0 20px rgba(255, 255, 255, 0.1);
            border: none;
            display: block;
        }
        
        /* æ§åˆ¶é¢æ¿ */
        .controls {
            margin-top: 15px;
            color: white;
            max-height: 180px;
            overflow-y: auto;
            padding: 0 clamp(8px, 2vw, 16px);
        }
        
        .control-group {
            margin: clamp(6px, 1.5vw, 12px) 0;
            display: block;
            width: 100%;
        }
        
        label {
            display: block;
            margin-bottom: clamp(3px, 1vw, 8px);
            color: #ccc;
            font-size: clamp(11px, 2vw, 16px);
            font-weight: 600;
        }
        
        input[type="range"] {
            width: 100%;
            height: clamp(3px, 0.5vw, 6px);
            border-radius: 2px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: clamp(12px, 2vw, 18px);
            height: clamp(12px, 2vw, 18px);
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
        }
        
        .value-display {
            color: #9f6fff;
            font-weight: 700;
            font-size: clamp(10px, 1.8vw, 14px);
        }
        
        /* å·¦ä¸‹è§’è®¾ç½®æŒ‰é’® */
        .settings-gear-btn {
            position: fixed;
            bottom: 30px;
            left: 30px;
            width: auto;
            height: auto;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            box-shadow: none;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 998;
            overflow: visible;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        .settings-gear-btn:hover {
            transform: scale(1.15);
        }
        
        .settings-gear-btn:active {
            transform: scale(0.95);
        }
        
        /* ç§»åŠ¨ç«¯è§¦æ‘¸åé¦ˆ */
        @media (hover: none) and (pointer: coarse) {
            .settings-gear-btn:active {
                transform: scale(0.98);
            }
        }

        /* ç§»é™¤æŒ‰é’®ç‚¹å‡»æ—¶çš„è“è‰²æ–¹æ¡† */
        button {
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        button:focus {
            outline: none;
        }

        /* é½¿è½® SVG æ ·å¼ */
        .gear-svg {
            width: 48px;
            height: 48px;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), filter 0.3s ease;
            filter: drop-shadow(0 0 8px rgba(102, 126, 234, 0.6));
        }

        .settings-gear-btn:hover .gear-svg {
            transform: rotate(-20deg);
            filter: drop-shadow(0 0 16px rgba(102, 126, 234, 0.9)) drop-shadow(0 0 24px rgba(128, 0, 255, 0.6));
        }

        .settings-gear-btn:active .gear-svg {
            transform: rotate(-30deg);
            filter: drop-shadow(0 0 12px rgba(102, 126, 234, 0.7));
        }
        
        /* å¼€å§‹å‚¬çœ æŒ‰é’® */
        .hypnosis-btn {
            position: fixed;
            bottom: 20%;
            left: 50%;
            transform: translate(-50%, 50%);
            width: 120px;   
            height: 120px;  
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 4px solid rgba(255, 255, 255, 0.5);
            color: white;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 
                0 16px 50px rgba(102, 126, 234, 0.8),
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                0 0 40px rgba(128, 0, 255, 0.5);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 999;
            overflow: visible;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* å°å±å¹•è®¾å¤‡ (æ‰‹æœºç«–å±) */
        @media screen and (max-width: 480px) {
            .hypnosis-btn {
                width: 100px;
                height: 100px;
                font-size: 14px;
            }
        }

        /* ä¸­ç­‰å±å¹•è®¾å¤‡ (æ‰‹æœºæ¨ªå±/å°å¹³æ¿) */
        @media screen and (min-width: 481px) and (max-width: 768px) {
            .hypnosis-btn {
                width: 120px;
                height: 120px;
                font-size: 16px;
            }
        }

        /* å¤§å±å¹•è®¾å¤‡ (å¹³æ¿/æ¡Œé¢) */
        @media screen and (min-width: 769px) and (max-width: 1024px) {
            .hypnosis-btn {
                width: 140px;
                height: 140px;
                font-size: 18px;
            }
        }

        /* è¶…å¤§å±å¹•è®¾å¤‡ (å¤§æ¡Œé¢) */
        @media screen and (min-width: 1025px) {
            .hypnosis-btn {
                width: 160px;
                height: 160px;
                font-size: 20px;
            }
        }
        
        .hypnosis-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .hypnosis-btn:hover {
            transform: translate(-50%, 50%) scale(1.1);
            box-shadow: 
                0 20px 60px rgba(102, 126, 234, 0.7),
                inset 0 1px 0 rgba(255, 255, 255, 0.4),
                0 0 50px rgba(128, 0, 255, 0.5);
        }
        
        .hypnosis-btn:active {
            transform: translate(-50%, 50%) scale(0.95);
            box-shadow: 
                0 8px 25px rgba(102, 126, 234, 0.4),
                inset 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        /* ç§»åŠ¨ç«¯è§¦æ‘¸åé¦ˆ */
        @media (hover: none) and (pointer: coarse) {
            .hypnosis-btn:active {
                transform: translate(-50%, 50%) scale(0.98);
            }
        }

        /* å¼ºåˆ¶é«˜æ½®æŒ‰é’® */
        .climax-btn {
            position: fixed;
            bottom: 20%;
            right: 8%;
            transform: translateY(50%);
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 3px solid rgba(255, 255, 255, 0.4);
            color: white;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 
                0 12px 35px rgba(102, 126, 234, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                0 0 30px rgba(128, 0, 255, 0.4);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 998;
            overflow: visible;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
        }

        /* å°å±å¹•è®¾å¤‡ (æ‰‹æœºç«–å±) */
        @media screen and (max-width: 480px) {
            .climax-btn {
                width: 70px;
                height: 70px;
                font-size: 11px;
            }
        }

        /* ä¸­ç­‰å±å¹•è®¾å¤‡ (æ‰‹æœºæ¨ªå±/å°å¹³æ¿) */
        @media screen and (min-width: 481px) and (max-width: 768px) {
            .climax-btn {
                width: 80px;
                height: 80px;
                font-size: 12px;
            }
        }

        /* å¤§å±å¹•è®¾å¤‡ (å¹³æ¿/æ¡Œé¢) */
        @media screen and (min-width: 769px) and (max-width: 1024px) {
            .climax-btn {
                width: 90px;
                height: 90px;
                font-size: 13px;
            }
        }

        /* è¶…å¤§å±å¹•è®¾å¤‡ (å¤§æ¡Œé¢) */
        @media screen and (min-width: 1025px) {
            .climax-btn {
                width: 100px;
                height: 100px;
                font-size: 14px;
            }
        }

        /* æŒ‰é’®æ˜¾ç¤ºçŠ¶æ€ï¼ˆå‚¬çœ æ¿€æ´»æ—¶ï¼‰ */
        .climax-btn.active {
            opacity: 1;
            pointer-events: all;
        }

        .climax-btn:hover {
            transform: translateY(50%) scale(1.12);
            box-shadow: 
                0 16px 45px rgba(102, 126, 234, 0.8),
                inset 0 1px 0 rgba(255, 255, 255, 0.4),
                0 0 40px rgba(128, 0, 255, 0.6);
        }

        .climax-btn:active {
            transform: translateY(50%) scale(0.93);
            box-shadow: 
                0 6px 18px rgba(102, 126, 234, 0.4),
                inset 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        /* ç§»åŠ¨ç«¯è§¦æ‘¸åé¦ˆ */
        @media (hover: none) and (pointer: coarse) {
            .climax-btn:active {
                transform: translateY(50%) scale(0.96);
            }
        }
        
        /* å¯åŠ¨å‚¬çœ æŒ‰é’®åŠ¨ç”» */
        @keyframes hypnosisActivate {
            0% {
                opacity: 0;
                transform: translate(-50%, 50%) scale(1.2);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, 50%) scale(1);
            }
        }
        
        .hypnosis-btn.activating {
            animation: hypnosisActivate 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        /* å¼ºåˆ¶é«˜æ½®è„‰å†²åŠ¨ç”» */
        @keyframes climaxPulse {
            0% {
                transform: translateY(50%) scale(1);
                box-shadow: 
                    0 12px 35px rgba(102, 126, 234, 0.6),
                    inset 0 1px 0 rgba(255, 255, 255, 0.3),
                    0 0 30px rgba(128, 0, 255, 0.4);
            }
            50% {
                transform: translateY(50%) scale(1.25);
                box-shadow: 
                    0 25px 70px rgba(102, 126, 234, 0.9),
                    inset 0 1px 0 rgba(255, 255, 255, 0.5),
                    0 0 80px rgba(128, 0, 255, 0.8);
            }
            100% {
                transform: translateY(50%) scale(1);
                box-shadow: 
                    0 12px 35px rgba(102, 126, 234, 0.6),
                    inset 0 1px 0 rgba(255, 255, 255, 0.3),
                    0 0 30px rgba(128, 0, 255, 0.4);
            }
        }
        
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        .controls::-webkit-scrollbar {
            width: 4px;
        }
        
        .controls::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
        }
        
        .controls::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.6);
            border-radius: 2px;
        }
        
        /* æµ®çª—è®¾ç½®èœå• */
        .settings-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: clamp(280px, 90vw, 500px);
            max-height: clamp(400px, 80vh, 800px);
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 2px solid rgba(102, 126, 234, 0.5);
            border-radius: clamp(16px, 3vw, 28px);
            box-shadow: 
                0 0 40px rgba(102, 126, 234, 0.4),
                0 0 80px rgba(128, 0, 255, 0.25),
                0 20px 60px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            backdrop-filter: blur(15px);
            animation: slideIn 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
            overflow: hidden;
        }
        
        .settings-modal.active {
            display: flex;
            flex-direction: column;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: clamp(12px, 3vw, 24px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            flex-shrink: 0;
        }
        
        .modal-header h2 {
            margin: 0;
            font-size: clamp(16px, 3vw, 24px);
            font-weight: 700;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: clamp(18px, 3vw, 28px);
            cursor: pointer;
            padding: 0;
            width: clamp(28px, 5vw, 40px);
            height: clamp(28px, 5vw, 40px);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            border-radius: 50%;
        }
        
        .close-btn:hover {
            transform: scale(1.15) rotate(90deg);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
        }
        
        .modal-content {
            overflow-y: auto;
            padding: clamp(12px, 3vw, 24px);
            flex: 1;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translate(-50%, -45%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }
        
        /* åŠé€æ˜èƒŒæ™¯ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            backdrop-filter: blur(3px);
        }
        
        .modal-overlay.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="phone-screen">
            
            <!-- åº”ç”¨æ ‡é¢˜æ  -->
            <div class="app-header">
                å‚¬çœ APP
            </div>
            
            <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
            <div id="container">
                <canvas id="glCanvas" width="500" height="500"></canvas>
            </div>
            
            <!-- æ¨¡æ€æ¡†èƒŒæ™¯ -->
            <div id="modalOverlay" class="modal-overlay" onclick="closeSettings()"></div>
            
            <!-- å·¦ä¸‹è§’è®¾ç½®æŒ‰é’® -->
            <button class="settings-gear-btn" onclick="toggleSettings()" title="è®¾ç½®">
                <svg class="gear-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="gearGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#764ba2;stop-opacity:1" />
                            <stop offset="50%" style="stop-color:#667eea;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#a78bfa;stop-opacity:1" />
                        </linearGradient>
                        <filter id="gearGlow">
                            <feGaussianBlur stdDeviation="1.5" result="coloredBlur"/>
                            <feMerge>
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                    </defs>
                    
                    <!-- é½¿è½®é½¿ï¼ˆ16ä¸ªï¼‰ -->
                    <g fill="url(#gearGradient)" filter="url(#gearGlow)">
                        <!-- ä¸Š -->
                        <rect x="92" y="20" width="16" height="18" rx="2"/>
                        <!-- å³ä¸Š -->
                        <g transform="rotate(22.5 100 100)">
                            <rect x="92" y="20" width="16" height="18" rx="2"/>
                        </g>
                        <!-- å³ä¸Šå -->
                        <g transform="rotate(45 100 100)">
                            <rect x="92" y="20" width="16" height="18" rx="2"/>
                        </g>
                        <!-- å³ -->
                        <g transform="rotate(67.5 100 100)">
                            <rect x="92" y="20" width="16" height="18" rx="2"/>
                        </g>
                        <!-- å³ä¸‹å -->
                        <g transform="rotate(90 100 100)">
                            <rect x="92" y="20" width="16" height="18" rx="2"/>
                        </g>
                        <!-- å³ä¸‹ -->
                        <g transform="rotate(112.5 100 100)">
                            <rect x="92" y="20" width="16" height="18" rx="2"/>
                        </g>
                        <!-- ä¸‹å -->
                        <g transform="rotate(135 100 100)">
                            <rect x="92" y="20" width="16" height="18" rx="2"/>
                        </g>
                        <!-- ä¸‹ -->
                        <g transform="rotate(157.5 100 100)">
                            <rect x="92" y="20" width="16" height="18" rx="2"/>
                        </g>
                        <!-- ä¸‹å·¦å -->
                        <g transform="rotate(180 100 100)">
                            <rect x="92" y="20" width="16" height="18" rx="2"/>
                        </g>
                        <!-- å·¦ä¸‹ -->
                        <g transform="rotate(202.5 100 100)">
                            <rect x="92" y="20" width="16" height="18" rx="2"/>
                        </g>
                        <!-- å·¦å -->
                        <g transform="rotate(225 100 100)">
                            <rect x="92" y="20" width="16" height="18" rx="2"/>
                        </g>
                        <!-- å·¦ä¸Šå -->
                        <g transform="rotate(247.5 100 100)">
                            <rect x="92" y="20" width="16" height="18" rx="2"/>
                        </g>
                        <!-- å·¦ -->
                        <g transform="rotate(270 100 100)">
                            <rect x="92" y="20" width="16" height="18" rx="2"/>
                        </g>
                        <!-- å·¦ä¸Š -->
                        <g transform="rotate(292.5 100 100)">
                            <rect x="92" y="20" width="16" height="18" rx="2"/>
                        </g>
                        <!-- ä¸Šå·¦å -->
                        <g transform="rotate(315 100 100)">
                            <rect x="92" y="20" width="16" height="18" rx="2"/>
                        </g>
                        <!-- ä¸Šå -->
                        <g transform="rotate(337.5 100 100)">
                            <rect x="92" y="20" width="16" height="18" rx="2"/>
                        </g>
                        
                        <!-- é½¿è½®ä¸»ä½“åœ†ç›˜ -->
                        <circle cx="100" cy="100" r="55" fill="url(#gearGradient)"/>
                    </g>
                    
                    <!-- ä¸­å¿ƒå­” -->
                    <circle cx="100" cy="100" r="20" fill="#1a1a2e"/>
                    
                    <!-- ä¸­å¿ƒè£…é¥°ç¯ -->
                    <circle cx="100" cy="100" r="20" fill="none" stroke="#667eea" stroke-width="2.5"/>
                    
                    <!-- ä¸­å¿ƒäº®ç‚¹ -->
                    <circle cx="100" cy="100" r="12" fill="none" stroke="white" stroke-width="1" opacity="0.5"/>
                    
                    <!-- ä¸­å¿ƒç‚¹ -->
                    <circle cx="100" cy="100" r="4" fill="#a78bfa"/>
                </svg>
            </button>
            
            <!-- æµ®çª—èœå• -->
            <div id="settingsModal" class="settings-modal">
                <div class="modal-header">
                    <h2>âš™ï¸ è®¾ç½®</h2>
                    <button class="close-btn" onclick="closeSettings()">âœ•</button>
                </div>
                <div class="modal-content">
                    <div class="control-group">
                        <label>èºæ—‹è‡‚: <span class="value-display" id="armsValue">6.0</span></label>
                        <input type="range" id="spiralArms" min="1" max="8" step="1.0" value="6.0">
                    </div>
                    
                    <div class="control-group">
                        <label>é—´è·: <span class="value-display" id="spacingValue">4.0</span></label>
                        <input type="range" id="spiralSpacing" min="1" max="8" step="0.1" value="4.0">
                    </div>
                    
                    <div class="control-group">
                        <label>èºæ—‹å¼ºåº¦: <span class="value-display" id="spiralGlowValue">0.02</span></label>
                        <input type="range" id="spiralGlow" min="0.01" max="1" step="0.01" value="0.02">
                    </div>
                    
                    <div class="control-group">
                        <label>å…‰ç¯å¼ºåº¦: <span class="value-display" id="rippleGlowValue">1.0</span></label>
                        <input type="range" id="rippleGlow" min="0.1" max="3" step="0.1" value="1.0">
                    </div>
                    
                    <div class="control-group">
                        <label>å…‰ç¯é€Ÿåº¦: <span class="value-display" id="rippleSpeedValue">4.0</span></label>
                        <input type="range" id="rippleSpeed" min="-10" max="10" step="0.1" value="4.0">
                    </div>
                    
                    <div class="control-group">
                        <label>é€Ÿåº¦: <span class="value-display" id="speedValue">2.0</span></label>
                        <input type="range" id="rotationSpeed" min="0" max="6" step="0.1" value="2.0">
                    </div>
                    
                    <div class="control-group" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.2);">
                        <button onclick="resetAllSettings()" style="width: 100%; padding: 10px; background: linear-gradient(135deg, #ff6b6b 0%, #ff8787 100%); border: none; border-radius: 8px; color: white; font-weight: 700; cursor: pointer; font-size: 14px; transition: all 0.3s;">
                            ğŸ”„ é‡ç½®æ‰€æœ‰è®¾ç½®
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- å¼€å§‹å‚¬çœ æŒ‰é’® -->
            <button class="hypnosis-btn" onclick="toggleHypnosis()">å¼€å§‹å‚¬çœ </button>
            
            <!-- å¼ºåˆ¶é«˜æ½®æŒ‰é’® -->
            <button class="climax-btn" onclick="triggerClimaxEffect()" title="å¼ºåˆ¶é«˜æ½®">å¼ºåˆ¶é«˜æ½®</button>
        </div>
    </div>

    <script>
        // å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', function(event) {
            console.error('âŒ JavaScripté”™è¯¯:', event.message);
            console.error('æ–‡ä»¶:', event.filename);
            console.error('è¡Œå·:', event.lineno);
            console.error('åˆ—å·:', event.colno);
            console.error('å®Œæ•´é”™è¯¯:', event.error);
        });
        
        // é¡¶ç‚¹ç€è‰²å™¨
        const vertexShaderSource = `
            attribute vec4 aVertexPosition;
            void main() {
                gl_Position = aVertexPosition;
            }
        `;

        // ç‰‡æ®µç€è‰²å™¨
        const fragmentShaderSource = `
            #ifdef GL_ES
            precision mediump float;
            #endif

            uniform vec2 u_resolution;
            uniform float u_time;
            uniform float u_spiralArms;
            uniform float u_spiralSpacing;
            uniform float u_spiralGlow;
            uniform float u_rippleGlow;
            uniform float u_rippleSpeed;
            uniform float u_rotationSpeed;
            uniform float u_activationProgress;
            uniform float u_deactivationProgress;
            uniform float u_climaxIntensity;

            void main() {
                vec2 uv = (gl_FragCoord.xy * 2.0 - u_resolution.xy) / u_resolution.y;
                float d = length(uv);
                
                float goldenRatio = 1.618033988749895;
                float spiralAngle = u_time * u_rotationSpeed;
                vec3 spiralColor = vec3(2.0, 0.5, 3.0);
                
                vec3 rippleColor = vec3(1.5, 0.3, 2.5);
                
                vec3 climaxColor = vec3(1.0, 0.4, 0.8);
                
                float angle = atan(uv.y, uv.x);
                float goldenSpacing = pow(goldenRatio, d * u_spiralSpacing); 
                float goldenSpiral = angle * u_spiralArms * 0.5 + goldenSpacing - spiralAngle;
                float spiralPattern = sin(goldenSpiral);
                spiralPattern = abs(spiralPattern);
                float spiralIntensity = (0.4 / spiralPattern) * u_spiralGlow;
                
                float ripple = sin(d * 10.0 - u_time * u_rippleSpeed) / 10.0;
                ripple = abs(ripple);
                float rippleIntensity = (0.02 / ripple) * u_rippleGlow;
                
                float expandRadius = u_activationProgress * 3.0;
                float expandWave = smoothstep(expandRadius + 0.3, expandRadius - 0.1, d);
                
                float expandGlow = exp(-pow(d - expandRadius, 2.0) * 8.0) * (1.0 - u_activationProgress * 0.5);
                
                float shrinkRadius = 3.0 - u_deactivationProgress * 3.0;
                float shrinkWave = smoothstep(shrinkRadius + 0.3, shrinkRadius - 0.1, d);
                
                float shrinkGlow = exp(-pow(d - shrinkRadius, 2.0) * 8.0) * u_deactivationProgress;
                
                float finalWave = mix(expandWave, shrinkWave, u_deactivationProgress);
                float finalGlow = mix(expandGlow, shrinkGlow, u_deactivationProgress);
                
                float climaxPulse = sin(u_time * 15.0) * 0.5 + 0.5;
                float climaxWave = smoothstep(0.5, 0.0, d) * u_climaxIntensity * 2.5;
                float climaxGlow = exp(-d * 1.5) * climaxPulse * u_climaxIntensity * 3.0;
                
                vec3 backgroundColor = vec3(0.0, 0.0, 0.0);
                vec3 spiralPart = spiralColor * spiralIntensity * finalWave;
                vec3 ripplePart = rippleColor * rippleIntensity * finalWave;
                vec3 expandPart = (spiralColor + rippleColor) * finalGlow;
                
                vec3 finalColor = mix(
                    backgroundColor + spiralPart + ripplePart + expandPart,
                    climaxColor * (climaxWave + climaxGlow),
                    u_climaxIntensity
                );

                gl_FragColor = vec4(finalColor, 1.0);
            }
        `;

        // WebGL åˆå§‹åŒ–
        const canvas = document.getElementById('glCanvas');
        
        if (!canvas) {
            console.error('æ‰¾ä¸åˆ°canvaså…ƒç´  glCanvas');
            throw new Error('Canvas element not found');
        }
        
        // åŠ¨æ€è®¾ç½®canvasåˆ†è¾¨ç‡ä»¥é€‚åº”å®¹å™¨
        function resizeCanvas() {
            const container = document.getElementById('container');
            if (!container) {
                console.error('æ‰¾ä¸åˆ°å®¹å™¨å…ƒç´  container');
                return;
            }
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
        }
        
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        const gl = canvas.getContext('webgl');

        if (!gl) {
            console.error('WebGLä¸å¯ç”¨');
            alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒWebGL');
            throw new Error('WebGL context not available');
        }
        
        console.log('WebGLåˆå§‹åŒ–æˆåŠŸ');

        // ç¼–è¯‘ç€è‰²å™¨
        function createShader(gl, type, source) {
            const shader = gl.createShader(type);
            gl.shaderSource(shader, source);
            gl.compileShader(shader);

            if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
                console.error('ç€è‰²å™¨ç¼–è¯‘é”™è¯¯:', gl.getShaderInfoLog(shader));
                gl.deleteShader(shader);
                return null;
            }

            return shader;
        }

        // åˆ›å»ºç€è‰²å™¨ç¨‹åº
        function createShaderProgram(gl, vertexSource, fragmentSource) {
            const vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexSource);
            const fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentSource);

            const shaderProgram = gl.createProgram();
            gl.attachShader(shaderProgram, vertexShader);
            gl.attachShader(shaderProgram, fragmentShader);
            gl.linkProgram(shaderProgram);

            if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {
                console.error('ç€è‰²å™¨ç¨‹åºé“¾æ¥é”™è¯¯:', gl.getProgramInfoLog(shaderProgram));
                return null;
            }

            return shaderProgram;
        }

        // åˆå§‹åŒ–
        const shaderProgram = createShaderProgram(gl, vertexShaderSource, fragmentShaderSource);

        // è·å–attributeå’Œuniformä½ç½®
        const programInfo = {
            attribLocations: {
                vertexPosition: gl.getAttribLocation(shaderProgram, 'aVertexPosition'),
            },
            uniformLocations: {
                resolution: gl.getUniformLocation(shaderProgram, 'u_resolution'),
                time: gl.getUniformLocation(shaderProgram, 'u_time'),
                spiralArms: gl.getUniformLocation(shaderProgram, 'u_spiralArms'),
                spiralSpacing: gl.getUniformLocation(shaderProgram, 'u_spiralSpacing'),
                spiralGlow: gl.getUniformLocation(shaderProgram, 'u_spiralGlow'),
                rippleGlow: gl.getUniformLocation(shaderProgram, 'u_rippleGlow'),
                rippleSpeed: gl.getUniformLocation(shaderProgram, 'u_rippleSpeed'),
                rotationSpeed: gl.getUniformLocation(shaderProgram, 'u_rotationSpeed'),
                activationProgress: gl.getUniformLocation(shaderProgram, 'u_activationProgress'),
                deactivationProgress: gl.getUniformLocation(shaderProgram, 'u_deactivationProgress'),
                climaxIntensity: gl.getUniformLocation(shaderProgram, 'u_climaxIntensity'),
            },
        };

        // åˆ›å»ºç¼“å†²åŒº
        const positionBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);

        const positions = [
            -1.0,  1.0,
             1.0,  1.0,
            -1.0, -1.0,
             1.0, -1.0,
        ];

        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(positions), gl.STATIC_DRAW);

        // æ§åˆ¶å‚æ•° - é»˜è®¤å€¼
        let spiralArms = 6.0;
        let spiralSpacing = 4.0;
        let spiralGlow = 0.02;
        let rippleGlow = 1.0;
        let rippleSpeed = 4.0;
        let rotationSpeed = 2.0;
        
        // ä¸ºäº†æ–¹ä¾¿åœ¨setupControlsä¸­è®¿é—®ï¼Œåˆ›å»ºä¸€ä¸ªå‚æ•°æ˜ å°„
        const paramMap = {
            spiralArms: () => spiralArms,
            spiralSpacing: () => spiralSpacing,
            spiralGlow: () => spiralGlow,
            rippleGlow: () => rippleGlow,
            rippleSpeed: () => rippleSpeed,
            rotationSpeed: () => rotationSpeed
        };

        // è‡ªåŠ¨ä¿å­˜å½“å‰è®¾ç½®åˆ° localStorage
        function autoSaveSettings() {
            try {
                const preset = {
                    spiralArms,
                    spiralSpacing,
                    spiralGlow,
                    rippleGlow,
                    rippleSpeed,
                    rotationSpeed
                };
                localStorage.setItem('hypnosisSettings', JSON.stringify(preset));
            } catch (e) {
                // å¦‚æœ localStorage ä¸å¯ç”¨ï¼Œé™é»˜å¤±è´¥ï¼ˆä¸æ‰“æ‰°ç”¨æˆ·ï¼‰
                console.warn('è®¾ç½®è‡ªåŠ¨ä¿å­˜å¤±è´¥:', e);
            }
        }

        // è‡ªåŠ¨åŠ è½½ä¹‹å‰ä¿å­˜çš„è®¾ç½®
        function autoLoadSettings() {
            try {
                const preset = localStorage.getItem('hypnosisSettings');
                if (preset) {
                    const settings = JSON.parse(preset);
                    spiralArms = settings.spiralArms !== undefined ? settings.spiralArms : spiralArms;
                    spiralSpacing = settings.spiralSpacing !== undefined ? settings.spiralSpacing : spiralSpacing;
                    spiralGlow = settings.spiralGlow !== undefined ? settings.spiralGlow : spiralGlow;
                    rippleGlow = settings.rippleGlow !== undefined ? settings.rippleGlow : rippleGlow;
                    rippleSpeed = settings.rippleSpeed !== undefined ? settings.rippleSpeed : rippleSpeed;
                    rotationSpeed = settings.rotationSpeed !== undefined ? settings.rotationSpeed : rotationSpeed;
                }
            } catch (e) {
                console.warn('è®¾ç½®è‡ªåŠ¨åŠ è½½å¤±è´¥:', e);
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ¢å¤è®¾ç½®
        autoLoadSettings();

        // æ§åˆ¶å™¨äº‹ä»¶
        function setupControls() {
            const controls = [
                { id: 'spiralArms', valueId: 'armsValue', variable: 'spiralArms' },
                { id: 'spiralSpacing', valueId: 'spacingValue', variable: 'spiralSpacing' },
                { id: 'spiralGlow', valueId: 'spiralGlowValue', variable: 'spiralGlow' },
                { id: 'rippleGlow', valueId: 'rippleGlowValue', variable: 'rippleGlow' },
                { id: 'rippleSpeed', valueId: 'rippleSpeedValue', variable: 'rippleSpeed' },
                { id: 'rotationSpeed', valueId: 'speedValue', variable: 'rotationSpeed' }
            ];

            controls.forEach(control => {
                const slider = document.getElementById(control.id);
                const valueDisplay = document.getElementById(control.valueId);
                
                if (!slider || !valueDisplay) {
                    console.warn(`å…ƒç´ æœªæ‰¾åˆ°: ${control.id} æˆ– ${control.valueId}`);
                    return;
                }
                
                // åˆå§‹åŒ–æ»‘å—å€¼ä¸ºå½“å‰å˜é‡å€¼
                const currentValue = paramMap[control.variable]();
                slider.value = currentValue;
                
                // åŒæ­¥æ›´æ–°æ˜¾ç¤ºå€¼
                if (control.variable === 'spiralGlow') {
                    valueDisplay.textContent = currentValue.toFixed(2);
                } else if (control.variable === 'rippleSpeed') {
                    // å…‰ç¯é€Ÿåº¦æ˜¾ç¤ºæ­£è´Ÿå·å’Œè¯´æ˜
                    const direction = currentValue > 0 ? '(æ‰©æ•£)' : currentValue < 0 ? '(æ”¶ç¼©)' : '(é™æ­¢)';
                    valueDisplay.textContent = `${currentValue.toFixed(1)} ${direction}`;
                } else {
                    valueDisplay.textContent = currentValue.toFixed(1);
                }
                
                slider.addEventListener('input', function() {
                    const value = parseFloat(this.value);
                    // å¯¹äºèºæ—‹å‘å…‰ä½¿ç”¨æ›´ç²¾ç¡®çš„æ˜¾ç¤ºæ ¼å¼
                    if (control.variable === 'spiralGlow') {
                        valueDisplay.textContent = value.toFixed(2);
                    } else if (control.variable === 'rippleSpeed') {
                        // å…‰ç¯é€Ÿåº¦æ˜¾ç¤ºæ­£è´Ÿå·å’Œè¯´æ˜
                        const direction = value > 0 ? '(æ‰©æ•£)' : value < 0 ? '(æ”¶ç¼©)' : '(é™æ­¢)';
                        valueDisplay.textContent = `${value.toFixed(1)} ${direction}`;
                    } else {
                        valueDisplay.textContent = value.toFixed(1);
                    }
                    
                    switch(control.variable) {
                        case 'spiralArms': spiralArms = value; break;
                        case 'spiralSpacing': spiralSpacing = value; break;
                        case 'spiralGlow': spiralGlow = value; break;
                        case 'rippleGlow': rippleGlow = value; break;
                        case 'rippleSpeed': rippleSpeed = value; break;
                        case 'rotationSpeed': rotationSpeed = value; break;
                    }
                    
                    // æ¯æ¬¡æ”¹å˜æ—¶è‡ªåŠ¨ä¿å­˜
                    autoSaveSettings();
                });
            });
        }

        // åœ¨åŠ è½½è®¾ç½®åç«‹å³è®¾ç½®æ§åˆ¶å™¨ï¼Œç¡®ä¿æ»‘å—å’Œæ•°å€¼åŒæ­¥
        try {
            setupControls();
        } catch (e) {
            console.error('è®¾ç½®æ§åˆ¶å™¨å¤±è´¥:', e);
        }

        // åº”ç”¨æ§åˆ¶åŠŸèƒ½
        let isPaused = false;
        let isHypnosisActive = false;
        let hypnosisStartTime = null; // å¯åŠ¨åŠ¨ç”»æ—¶é—´
        let hypnosisEndTime = null; // ç»“æŸåŠ¨ç”»æ—¶é—´
        let climaxStartTime = null; // é«˜æ½®æ•ˆæœå¼€å§‹æ—¶é—´
        let animationId;

        // æš‚åœ/æ’­æ”¾åŠŸèƒ½
        window.togglePause = function() {
            isPaused = !isPaused;
            const buttons = document.querySelectorAll('.control-btn');
            buttons[1].innerHTML = isPaused ? '<span>â–¶ï¸</span><span>æ’­æ”¾</span>' : '<span>â¸ï¸</span><span>æš‚åœ</span>';
        };

        // å¼€å§‹å‚¬çœ æŒ‰é’®
        window.toggleHypnosis = function() {
            const hypnosisBtn = document.querySelector('.hypnosis-btn');
            isHypnosisActive = !isHypnosisActive;
            hypnosisBtn.textContent = isHypnosisActive ? 'ç»“æŸå‚¬çœ ' : 'å¼€å§‹å‚¬çœ ';
            
            // ç®¡ç†å¼ºåˆ¶é«˜æ½®æŒ‰é’®çš„å¯è§æ€§
            const climaxBtn = document.querySelector('.climax-btn');
            if (isHypnosisActive) {
                climaxBtn.classList.add('active');
            } else {
                climaxBtn.classList.remove('active');
            }
            
            // å½“æ¿€æ´»å‚¬çœ æ—¶ï¼Œé‡ç½®æš‚åœçŠ¶æ€å’Œå¯åŠ¨åŠ¨ç”»
            if (isHypnosisActive) {
                isPaused = false;
                hypnosisStartTime = null; // é‡ç½®ä¸ºnullï¼Œä¸‹æ¬¡renderæ—¶ä¼šè®¾ç½®ä¸ºå½“å‰æ—¶é—´
                hypnosisEndTime = null; // é‡ç½®ç»“æŸæ—¶é—´
                
                // æ·»åŠ å¯åŠ¨åŠ¨ç”»ç±»
                hypnosisBtn.classList.add('activating');
                setTimeout(() => hypnosisBtn.classList.remove('activating'), 600);
            } else {
                // ç»“æŸå‚¬çœ æ—¶ï¼Œè®°å½•ç»“æŸå¼€å§‹çš„æ—¶é—´ä»¥è¿›è¡Œæ¶ˆé€€åŠ¨ç”»
                hypnosisEndTime = performance.now();
            }
        };

        // å¼ºåˆ¶é«˜æ½®æ•ˆæœ
        window.triggerClimaxEffect = function() {
            if (!isHypnosisActive) {
                alert('è¯·å…ˆå¼€å§‹å‚¬çœ ');
                return;
            }
            
            // è®°å½•é«˜æ½®æ•ˆæœçš„å¼€å§‹æ—¶é—´
            climaxStartTime = performance.now();
            
            const climaxBtn = document.querySelector('.climax-btn');
            
            // åªè§¦å‘è„‰å†²åŠ¨ç”»ï¼Œä¸ç»“æŸå‚¬çœ 
            climaxBtn.style.animation = 'none';
            setTimeout(() => {
                climaxBtn.style.animation = 'climaxPulse 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)';
            }, 10);
        };

        // é‡ç½®è®¾ç½®
        window.resetSettings = function() {
            spiralArms = 6.0;
            spiralSpacing = 4.0;
            spiralGlow = 0.02;
            rippleGlow = 1.0;
            rippleSpeed = 4.0;
            rotationSpeed = 2.0;
            
            // æ›´æ–°æ»‘å—å€¼
            document.getElementById('spiralArms').value = spiralArms;
            document.getElementById('spiralSpacing').value = spiralSpacing;
            document.getElementById('spiralGlow').value = spiralGlow;
            document.getElementById('rippleGlow').value = rippleGlow;
            document.getElementById('rippleSpeed').value = rippleSpeed;
            document.getElementById('rotationSpeed').value = rotationSpeed;
            
            // æ›´æ–°æ˜¾ç¤ºå€¼
            document.getElementById('armsValue').textContent = spiralArms.toFixed(1);
            document.getElementById('spacingValue').textContent = spiralSpacing.toFixed(1);
            document.getElementById('spiralGlowValue').textContent = spiralGlow.toFixed(2);
            document.getElementById('rippleGlowValue').textContent = rippleGlow.toFixed(1);
            document.getElementById('rippleSpeedValue').textContent = `${rippleSpeed.toFixed(1)} (æ‰©æ•£)`;
            document.getElementById('speedValue').textContent = rotationSpeed.toFixed(1);
        };

        // å…¨å±åŠŸèƒ½
        window.toggleFullscreen = function() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        };

        // ä¸å†ä¿å­˜/åŠ è½½é¢„è®¾ï¼Œä¿ç•™é‡ç½®åŠŸèƒ½

        // è®¾ç½®èœå•æ§åˆ¶
        window.toggleSettings = function() {
            const modal = document.getElementById('settingsModal');
            const overlay = document.getElementById('modalOverlay');
            modal.classList.toggle('active');
            overlay.classList.toggle('active');
        };

        window.closeSettings = function() {
            const modal = document.getElementById('settingsModal');
            const overlay = document.getElementById('modalOverlay');
            modal.classList.remove('active');
            overlay.classList.remove('active');
        };

        // é‡ç½®æ‰€æœ‰è®¾ç½®
        window.resetAllSettings = function() {
            // é»˜è®¤å€¼
            const defaults = {
                spiralArms: 6.0,
                spiralSpacing: 4.0,
                spiralGlow: 0.02,
                rippleGlow: 1.0,
                rippleSpeed: 4.0,
                rotationSpeed: 2.0
            };
            
            // é‡ç½®æ‰€æœ‰inputå…ƒç´ çš„å€¼
            document.getElementById('spiralArms').value = defaults.spiralArms;
            document.getElementById('spiralSpacing').value = defaults.spiralSpacing;
            document.getElementById('spiralGlow').value = defaults.spiralGlow;
            document.getElementById('rippleGlow').value = defaults.rippleGlow;
            document.getElementById('rippleSpeed').value = defaults.rippleSpeed;
            document.getElementById('rotationSpeed').value = defaults.rotationSpeed;
            
            // æ›´æ–°æ˜¾ç¤ºå€¼
            document.getElementById('armsValue').textContent = defaults.spiralArms.toFixed(1);
            document.getElementById('spacingValue').textContent = defaults.spiralSpacing.toFixed(1);
            document.getElementById('spiralGlowValue').textContent = defaults.spiralGlow.toFixed(2);
            document.getElementById('rippleGlowValue').textContent = defaults.rippleGlow.toFixed(1);
            document.getElementById('rippleSpeedValue').textContent = defaults.rippleSpeed.toFixed(1);
            document.getElementById('speedValue').textContent = defaults.rotationSpeed.toFixed(1);
            
            // æ›´æ–°å…¨å±€å˜é‡
            spiralArms = defaults.spiralArms;
            spiralSpacing = defaults.spiralSpacing;
            spiralGlow = defaults.spiralGlow;
            rippleGlow = defaults.rippleGlow;
            rippleSpeed = defaults.rippleSpeed;
            rotationSpeed = defaults.rotationSpeed;
            
            // æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼ˆlocalStorageï¼‰
            localStorage.clear();
            
            // æ˜¾ç¤ºé‡ç½®æˆåŠŸçš„åé¦ˆ
            alert('âœ… æ‰€æœ‰è®¾ç½®å·²é‡ç½®ï¼');
        };

        // ESCé”®å…³é—­èœå•
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeSettings();
            }
        });

        // æ¸²æŸ“å¾ªç¯
        let lastTime = 0;
        let pausedTime = 0;
        
        function render(time) {
            gl.viewport(0, 0, canvas.width, canvas.height);
            gl.clearColor(0.0, 0.0, 0.0, 1.0);
            gl.clear(gl.COLOR_BUFFER_BIT);

            let activationProgress = 0.0;
            let deactivationProgress = 0.0;
            
            // è®¡ç®—é«˜æ½®å¼ºåº¦ï¼ˆä»climaxStartTimeå¼€å§‹çš„0.6ç§’å†…çº¿æ€§è¡°å‡ï¼‰
            let climaxIntensity = 0.0;
            if (climaxStartTime !== null) {
                const climaxDuration = 600; // æ¯«ç§’
                const currentTime = performance.now();
                const climaxElapsed = currentTime - climaxStartTime;
                
                if (climaxElapsed < climaxDuration) {
                    // ä»1.0çº¿æ€§è¡°å‡åˆ°0.0
                    climaxIntensity = Math.max(0.0, 1.0 - (climaxElapsed / climaxDuration));
                } else {
                    // é«˜æ½®æ•ˆæœå·²ç»“æŸ
                    climaxStartTime = null;
                    climaxIntensity = 0.0;
                }
            }

            // åªæœ‰åœ¨å‚¬çœ æ¿€æ´»æ—¶æ‰ç»˜åˆ¶ç€è‰²å™¨
            if (isHypnosisActive) {
                // å¦‚æœæ˜¯é¦–æ¬¡æ¿€æ´»ï¼Œè®°å½•å¯åŠ¨æ—¶é—´
                if (hypnosisStartTime === null) {
                    hypnosisStartTime = time;
                    hypnosisEndTime = null;
                }

                // è®¡ç®—å¯åŠ¨åŠ¨ç”»è¿›åº¦ (0-1ï¼Œå†æ—¶600ms)
                const activationDuration = 600; // æ¯«ç§’
                activationProgress = Math.min((time - hypnosisStartTime) / activationDuration, 1.0);

                if (!isPaused) {
                    time *= 0.001; // è½¬æ¢ä¸ºç§’
                    lastTime = time - pausedTime;
                } else {
                    pausedTime = (time * 0.001) - lastTime;
                }

                gl.useProgram(shaderProgram);

                // è®¾ç½®attributes
                gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
                gl.vertexAttribPointer(programInfo.attribLocations.vertexPosition, 2, gl.FLOAT, false, 0, 0);
                gl.enableVertexAttribArray(programInfo.attribLocations.vertexPosition);

                // æ ¹æ®å¯åŠ¨è¿›åº¦è°ƒæ•´å‚æ•°
                // æ¸è¿›å¼å¢åŠ èºæ—‹å¼ºåº¦ã€å…‰ç¯å¼ºåº¦ç­‰ï¼Œå½¢æˆ"è‹é†’"æ•ˆæœ
                const currentSpiralGlow = spiralGlow * activationProgress;
                const currentRippleGlow = rippleGlow * activationProgress;

                // è®¾ç½®uniforms
                gl.uniform2f(programInfo.uniformLocations.resolution, canvas.width, canvas.height);
                gl.uniform1f(programInfo.uniformLocations.time, lastTime);
                gl.uniform1f(programInfo.uniformLocations.spiralArms, spiralArms);
                gl.uniform1f(programInfo.uniformLocations.spiralSpacing, spiralSpacing);
                gl.uniform1f(programInfo.uniformLocations.spiralGlow, currentSpiralGlow);
                gl.uniform1f(programInfo.uniformLocations.rippleGlow, currentRippleGlow);
                gl.uniform1f(programInfo.uniformLocations.rippleSpeed, rippleSpeed);
                gl.uniform1f(programInfo.uniformLocations.rotationSpeed, rotationSpeed);
                gl.uniform1f(programInfo.uniformLocations.activationProgress, activationProgress);
                gl.uniform1f(programInfo.uniformLocations.deactivationProgress, 0.0);
                gl.uniform1f(programInfo.uniformLocations.climaxIntensity, climaxIntensity);

                gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
            } else if (hypnosisEndTime !== null) {
                // ç»“æŸå‚¬çœ åçš„æ¶ˆé€€åŠ¨ç”»
                const deactivationDuration = 600; // æ¯«ç§’
                const currentTime = performance.now();
                deactivationProgress = Math.min((currentTime - hypnosisEndTime) / deactivationDuration, 1.0);

                if (deactivationProgress < 1.0) {
                    // åŠ¨ç”»è¿˜åœ¨è¿›è¡Œä¸­
                    if (!isPaused) {
                        time *= 0.001; // è½¬æ¢ä¸ºç§’
                        lastTime = time - pausedTime;
                    } else {
                        pausedTime = (time * 0.001) - lastTime;
                    }

                    gl.useProgram(shaderProgram);

                    // è®¾ç½®attributes
                    gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
                    gl.vertexAttribPointer(programInfo.attribLocations.vertexPosition, 2, gl.FLOAT, false, 0, 0);
                    gl.enableVertexAttribArray(programInfo.attribLocations.vertexPosition);

                    // æ¶ˆé€€æ—¶é€æ¸å‡å¼±æ•ˆæœ
                    const currentSpiralGlow = spiralGlow * (1.0 - deactivationProgress);
                    const currentRippleGlow = rippleGlow * (1.0 - deactivationProgress);

                    // è®¾ç½®uniforms
                    gl.uniform2f(programInfo.uniformLocations.resolution, canvas.width, canvas.height);
                    gl.uniform1f(programInfo.uniformLocations.time, lastTime);
                    gl.uniform1f(programInfo.uniformLocations.spiralArms, spiralArms);
                    gl.uniform1f(programInfo.uniformLocations.spiralSpacing, spiralSpacing);
                    gl.uniform1f(programInfo.uniformLocations.spiralGlow, currentSpiralGlow);
                    gl.uniform1f(programInfo.uniformLocations.rippleGlow, currentRippleGlow);
                    gl.uniform1f(programInfo.uniformLocations.rippleSpeed, rippleSpeed);
                    gl.uniform1f(programInfo.uniformLocations.rotationSpeed, rotationSpeed);
                    gl.uniform1f(programInfo.uniformLocations.activationProgress, 1.0); // å·²å®Œå…¨å¯åŠ¨
                    gl.uniform1f(programInfo.uniformLocations.deactivationProgress, deactivationProgress);
                    gl.uniform1f(programInfo.uniformLocations.climaxIntensity, climaxIntensity);

                    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
                } else {
                    // åŠ¨ç”»å®Œæˆï¼Œæ¸…ç©ºç»“æŸæ—¶é—´
                    hypnosisEndTime = null;
                }
            }

            animationId = requestAnimationFrame(render);
        }

        requestAnimationFrame(render);
        console.log('æ¸²æŸ“å¾ªç¯å·²å¯åŠ¨');
    </script>
</body>
</html>
